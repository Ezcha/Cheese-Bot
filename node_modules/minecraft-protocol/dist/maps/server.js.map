{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["var net = require('net');\nvar EventEmitter = require('events').EventEmitter;\nvar Client = require('./client');\nvar states = require(\"./states\");\n\nclass Server extends EventEmitter\n{\n  socketServer=null;\n  cipher=null;\n  decipher=null;\n  clients={};\n\n  constructor(version) {\n    super();\n    this.version=version;\n  }\n\n  listen(port, host) {\n    var self = this;\n    var nextId = 0;\n    self.socketServer = net.createServer();\n    self.socketServer.on('connection', socket => {\n      var client = new Client(true,this.version);\n      client._end = client.end;\n      client.end = function end(endReason) {\n        endReason='{\"text\":\"'+endReason+'\"}';\n        if(client.state === states.PLAY) {\n          client.write('kick_disconnect', {reason: endReason});\n        } else if(client.state === states.LOGIN) {\n          client.write('disconnect', {reason: endReason});\n        }\n        client._end(endReason);\n      };\n      client.id = nextId++;\n      self.clients[client.id] = client;\n      client.on('end', function() {\n        delete self.clients[client.id];\n      });\n      client.setSocket(socket);\n      self.emit('connection', client);\n    });\n    self.socketServer.on('error', function(err) {\n      self.emit('error', err);\n    });\n    self.socketServer.on('close', function() {\n      self.emit('close');\n    });\n    self.socketServer.on('listening', function() {\n      self.emit('listening');\n    });\n    self.socketServer.listen(port, host);\n  }\n\n  close() {\n    var client;\n    for(var clientId in this.clients) {\n      if(!this.clients.hasOwnProperty(clientId)) continue;\n\n      client = this.clients[clientId];\n      client.end('ServerShutdown');\n    }\n    this.socketServer.close();\n  }\n}\n\nmodule.exports = Server;\n"],"sourceRoot":"/source/"}