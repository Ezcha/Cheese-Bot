{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client.js","sourcesContent":["var EventEmitter = require('events').EventEmitter;\nvar debug = require('./debug');\nvar compression = require('./transforms/compression');\nvar framing = require('./transforms/framing');\nvar crypto = require('crypto');\nvar states = require(\"./states\");\n\nvar createSerializer=require(\"./transforms/serializer\").createSerializer;\nvar createDeserializer=require(\"./transforms/serializer\").createDeserializer;\n\nclass Client extends EventEmitter\n{\n  packetsToParse={};\n  serializer;\n  compressor=null;\n  framer=framing.createFramer();\n  cipher=null;\n  decipher=null;\n  splitter=framing.createSplitter();\n  decompressor=null;\n  deserializer;\n  isServer;\n  version;\n  protocolState=states.HANDSHAKING;\n\n  constructor(isServer,version) {\n    super();\n    this.version=version;\n    this.isServer = !!isServer;\n    this.setSerializer(states.HANDSHAKING);\n\n    this.on('newListener', function(event, listener) {\n      var direction = this.isServer ? 'toServer' : 'toClient';\n      if(typeof this.packetsToParse[event] === \"undefined\") this.packetsToParse[event] = 1;\n      else this.packetsToParse[event] += 1;\n    });\n    this.on('removeListener', function(event, listener) {\n      var direction = this.isServer ? 'toServer' : 'toClient';\n      this.packetsToParse[event] -= 1;\n    });\n  }\n\n  get state(){\n    return this.protocolState;\n  }\n\n\n  setSerializer(state) {\n    this.serializer = createSerializer({ isServer:this.isServer, version:this.version, state: state});\n    this.deserializer = createDeserializer({ isServer:this.isServer, version:this.version, state: state, packetsToParse:\n      this.packetsToParse});\n\n\n    this.serializer.on('error', (e) => {\n      var parts=e.field.split(\".\");\n      parts.shift();\n      var serializerDirection = !this.isServer ? 'toServer' : 'toClient';\n      e.field = [this.protocolState, serializerDirection].concat(parts).join(\".\");\n      e.message = `Serialization error for ${e.field} : ${e.message}`;\n      this.emit('error',e);\n    });\n\n\n    this.deserializer.on('error', (e) => {\n      var parts=e.field.split(\".\");\n      parts.shift();\n      var deserializerDirection = this.isServer ? 'toServer' : 'toClient';\n      e.field = [this.protocolState, deserializerDirection].concat(parts).join(\".\");\n      e.message = `Deserialization error for ${e.field} : ${e.message}`;\n      this.emit('error',e);\n    });\n\n    this.deserializer.on('data', (parsed) => {\n      parsed.metadata.name=parsed.data.name;\n      parsed.data=parsed.data.params;\n      parsed.metadata.state=state;\n      this.emit('packet', parsed.data, parsed.metadata);\n      this.emit(parsed.metadata.name, parsed.data, parsed.metadata);\n      this.emit('raw.' + parsed.metadata.name, parsed.buffer, parsed.metadata);\n      this.emit('raw', parsed.buffer, parsed.metadata);\n    });\n  }\n\n  set state(newProperty) {\n    var oldProperty = this.protocolState;\n    this.protocolState = newProperty;\n\n    if(!this.compressor)\n    {\n      this.serializer.unpipe(this.framer);\n      this.splitter.unpipe(this.deserializer);\n    }\n    else\n    {\n      this.serializer.unpipe(this.compressor);\n      this.decompressor.unpipe(this.deserializer);\n    }\n\n    this.serializer.removeAllListeners();\n    this.deserializer.removeAllListeners();\n    this.setSerializer(this.protocolState);\n\n    if(!this.compressor)\n    {\n      this.serializer.pipe(this.framer);\n      this.splitter.pipe(this.deserializer);\n    }\n    else\n    {\n      this.serializer.pipe(this.compressor);\n      this.decompressor.pipe(this.deserializer);\n    }\n\n    this.emit('state', newProperty, oldProperty);\n  }\n\n  get compressionThreshold() {\n    return this.compressor == null ? -2 : this.compressor.compressionThreshold;\n  }\n\n  set compressionThreshold(threshold) {\n    this.setCompressionThreshold(threshold);\n  }\n\n  setSocket(socket) {\n    var ended = false;\n\n    // TODO : A lot of other things needs to be done.\n    var endSocket = () => {\n      if(ended) return;\n      ended = true;\n      this.socket.removeListener('close', endSocket);\n      this.socket.removeListener('end', endSocket);\n      this.socket.removeListener('timeout', endSocket);\n      this.emit('end', this._endReason);\n    };\n\n    var onFatalError = (err) => {\n      this.emit('error', err);\n      endSocket();\n    };\n\n    var onError = (err) => this.emit('error', err);\n\n    this.socket = socket;\n\n    if(this.socket.setNoDelay)\n      this.socket.setNoDelay(true);\n\n    this.socket.on('connect', () => this.emit('connect'));\n\n    this.socket.on('error', onFatalError);\n    this.socket.on('close', endSocket);\n    this.socket.on('end', endSocket);\n    this.socket.on('timeout', endSocket);\n    this.framer.on('error', onError);\n    this.splitter.on('error', onError);\n\n    this.socket.pipe(this.splitter).pipe(this.deserializer);\n    this.serializer.pipe(this.framer).pipe(this.socket);\n  }\n\n  end(reason) {\n    this._endReason = reason;\n    if(this.socket) this.socket.end();\n  }\n\n  setEncryption(sharedSecret) {\n    if (this.cipher != null)\n      throw new Error(\"Set encryption twice !\");\n    this.cipher = crypto.createCipheriv('aes-128-cfb8', sharedSecret, sharedSecret);\n    this.cipher.on('error', (err) => this.emit('error', err));\n    this.framer.unpipe(this.socket);\n    this.framer.pipe(this.cipher).pipe(this.socket);\n    this.decipher = crypto.createDecipheriv('aes-128-cfb8', sharedSecret, sharedSecret);\n    this.decipher.on('error', (err) => this.emit('error', err));\n    this.socket.unpipe(this.splitter);\n    this.socket.pipe(this.decipher).pipe(this.splitter);\n  }\n\n  setCompressionThreshold(threshold) {\n    if (this.compressor == null) {\n      this.compressor = compression.createCompressor(threshold);\n      this.compressor.on('error', (err) => this.emit('error', err));\n      this.serializer.unpipe(this.framer);\n      this.serializer.pipe(this.compressor).pipe(this.framer);\n      this.decompressor = compression.createDecompressor(threshold);\n      this.decompressor.on('error', (err) => this.emit('error', err));\n      this.splitter.unpipe(this.deserializer);\n      this.splitter.pipe(this.decompressor).pipe(this.deserializer);\n    } else {\n      this.decompressor.threshold = threshold;\n      this.compressor.threshold = threshold;\n    }\n  }\n\n  write(name, params) {\n    debug(\"writing packet \" + this.state + \".\" + name);\n    debug(params);\n    this.serializer.write({ name, params });\n  }\n\n  writeRaw(buffer) {\n    if (this.compressor === null)\n      this.framer.write(buffer);\n    else\n      this.compressor.write(buffer);\n  }\n}\n\nmodule.exports = Client;\n"],"sourceRoot":"/source/"}